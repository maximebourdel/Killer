{# On étend notre layout #}
{% extends "::layout.html.twig" %}



{# Dans notre layout, il faut définir le block body #}
{% block body %}

<div class="container">
    <h3>Bienvenue à toi jeune fou, mais où veux tu donc tuer à souhaits ?</h3>
    
    <div class="well col-sm-7">
        Rechercher sur la carte
        <br />
        <div id="map-canvas" style="height:400px;" ></div>
        
    </div>
    
     <div class="well col-sm-4 col-sm-offset-1">
        Ou sur le moteur de recherche
        <br />
       
            <input type="text" id="searchKiller" size="20"  />
             
        <div class="col-sm-12">
            <br />
            <table id="select">
                <tbody>

                </tbody>
            </table>
        </div>
    </div>
   
</div>

{% endblock %}

{% block script %}
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js">
    </script>
    <script type="text/javascript">
      function initialize() {

    	//si il y a un ou plusieurs probleme
    	var mapOptions = {
    		zoom: 5,
    		//on définit le zoom entre les deux
    		center: new google.maps.LatLng( 46.227638 , 2.213749000000007 )
    	};

		//on charge la map
		var map = new google.maps.Map(
  			document.getElementById('map-canvas'),
  			mapOptions
  		);


      	var myMarker = new Array();
      	var myWindowOptions = new Array();
      	var myInfoWindow = new Array();


      	{% for killer in killers %}
    		

    		//représente l'image à afficher
    		//var iconMarker = './markers/'+ 13 +'.png';
       
    		var id = {{ killer.id }}
      		myMarker[id] = new google.maps.Marker({
      			numero: id,
      			position: new google.maps.LatLng({{ killer.latitude }}, {{ killer.longitude }}),
      			map: map,
      			title: "{{ killer.name }}",
      			//icon: iconMarker
      		});
      		// Options de la fenêtre
      				
    	    			
      				
      		myWindowOptions[id] = {
      			content:
    	        		'<a href="{{ path('games_killer_consultKiller', {'name': killer.name} ) }}">{{ killer.name }}</a>'		
      		};
      		
      		// Création de la fenêtre
      		myInfoWindow[id] = new google.maps.InfoWindow(myWindowOptions[id]); 
    
      		// Affichage de la fenêtre au click sur le marker
      		google.maps.event.addListener(myMarker[id], 'click', function() {
      			myInfoWindow[this.numero].open(this.map, myMarker[this.numero]);
      		});  
      	{% endfor %}
      
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    
       
    
    <script> $('#index').addClass('active');
    
    

    
    //#searchKiller représente la liste déroulante des pays, on lui indique de lancer une fonction au changement de choix dans la liste déroulante grâce à ".change(...).
    $("#searchKiller").keyup(function() {
        $.ajax({

            //On lui indique le type d'envoie des informations
            type: 'POST',
            //On lui indique le chemin de la fonction
            url:  '{{ path('games_killer_ajaxrqSearchKiller') }}',

            //On lui donne la valeur du choix qu'on a fait, et id est la variable qui va contenir notre valeur, nous la retrouvons dans notre controller
            data: 'adresse=' + $(this).val(),

            //Enfin nous lui disons de remplir notre formulaire avec le resultat 
            success: function(response)
            {
            	$("#select div").remove();
                $.each(response, function(i, item) {
                    
                	var url = '{{ path("games_killer_consultKiller", {"name": "name"}) }}';
                	url = url.replace("name", item);  
                	
                    $('#select').append(
                            '<div class="well col-sm-12">'+
                                '<tr><td><a href="'+url+'">'+item+'<a><td></tr>'+
                    	    '</div>'
                    );
                });
            }
        }
    )});
    
    
    

   
    
</script>
{% endblock %}



